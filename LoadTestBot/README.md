# 채팅서버 부하테스트 봇

Python으로 개발된 채팅서버 부하테스트 도구입니다. 여러 개의 봇 클라이언트를 동시에 실행하여 서버의 성능과 안정성을 테스트할 수 있습니다.

## 주요 기능

### 1. 부하테스트 봇
- 동시 다중 클라이언트 연결
- 자동 채팅 메시지 전송
- 실시간 통계 및 모니터링
- 네트워크 지연시간 측정
- 사용자 정의 메시지 브로드캐스트

### 2. 서버 모니터링
- 서버 프로세스 리소스 사용량 모니터링
- CPU, 메모리, 네트워크 사용량 추적
- 실시간 연결 수 모니터링
- 모니터링 데이터 내보내기

## 파일 구조

```
LoadTestBot/
├── main.py                 # 메인 실행 파일
├── load_test_manager.py    # 부하테스트 매니저
├── chat_bot_client.py      # 개별 봇 클라이언트
├── packets.py              # 패킷 클래스들
├── packet_util.py          # 패킷 유틸리티
├── packet_types.py         # 패킷 타입 정의
├── server_monitor.py       # 서버 모니터링 도구
└── README.md              # 이 파일
```

## 설치 및 실행

### 필요 패키지 설치
```bash
pip install psutil
```

### 기본 실행 (대화형 모드)
```bash
python main.py
```

### 명령줄 옵션
```bash
python main.py --host localhost --port 9200 --interactive
```

### 배치 모드 실행
```bash
# 10개 봇으로 60초간 테스트
python main.py --bots 10 --duration 60 --output results.json

# 서버 주소 지정
python main.py --host 192.168.1.100 --port 9200 --bots 5 --duration 30
```

## 사용법

### 대화형 모드 명령어

1. **start <봇수> [테스트시간(초)]** - 부하테스트 시작
   ```
   start 10        # 10개 봇으로 무제한 테스트
   start 20 300    # 20개 봇으로 300초간 테스트
   ```

2. **stop** - 부하테스트 중지
   ```
   stop
   ```

3. **stats** - 현재 통계 표시
   ```
   stats
   ```

4. **export [파일명]** - 통계 JSON 파일로 내보내기
   ```
   export              # 자동 파일명
   export my_test.json # 지정된 파일명
   ```

5. **broadcast <메시지>** - 모든 봇에게 메시지 전송
   ```
   broadcast 안녕하세요 모든 봇들!
   ```

6. **quit** - 프로그램 종료
   ```
   quit
   ```

### 서버 모니터링 실행

```bash
# 기본 모니터링
python server_monitor.py

# 특정 프로세스 모니터링
python server_monitor.py --process ChattingServer.exe --interval 2.0

# 300초간 모니터링 후 결과 저장
python server_monitor.py --duration 300 --output server_stats.json
```

## 테스트 시나리오 예시

### 1. 기본 부하테스트
```bash
# 10개 봇으로 5분간 테스트
python main.py --bots 10 --duration 300
```

### 2. 점진적 부하 증가 테스트
```bash
# 대화형 모드에서 순차적으로 실행
start 5      # 5개 봇으로 시작
# 잠시 후
stop
start 10     # 10개 봇으로 증가
# 잠시 후
stop
start 20     # 20개 봇으로 증가
```

### 3. 서버 모니터링과 함께 테스트
```bash
# 터미널 1: 서버 모니터링
python server_monitor.py --output monitoring.json

# 터미널 2: 부하테스트
python main.py --bots 15 --duration 600 --output loadtest.json
```

## 출력 예시

### 부하테스트 통계
```
================================================================================
부하테스트 상태 - 2025-06-06 14:30:15
================================================================================
테스트 시간: 125.3초
봇 상태: 10/10 연결됨
메시지: 전송 156, 수신 1520
오류 수: 0
레이턴시: 평균 23.4ms, 최소 12ms, 최대 45ms
처리량: 1.2 메시지/초
```

### 서버 모니터링
```
서버 모니터링 - 2025-06-06T14:30:15 (경과: 125.3초)
======================================================================
시스템 CPU: 15.2%
시스템 메모리: 68.4% (5.5GB/8.0GB)
디스크 사용량: 45.2% (225GB/500GB)
네트워크: 송신 1.2MB, 수신 2.3MB

서버 프로세스:
  CPU: 12.5%
  메모리: 8.3% (664MB)
  스레드: 15
  연결: 10
  상태: running
```

## 주요 특징

### 봇 클라이언트
- 자동 이름 등록
- 랜덤 채팅 메시지 전송 (3-8초 간격)
- 주기적 핑 테스트 (30초 간격)
- 연결 재시도 로직
- 통계 수집 및 보고

### 테스트 매니저
- 다중 봇 생성 및 관리
- 점진적 연결 (서버 부하 방지)
- 실시간 통계 모니터링
- JSON 형태 결과 내보내기
- 브로드캐스트 메시지 기능

### 서버 모니터링
- 프로세스별 리소스 사용량 추적
- 시스템 전체 성능 모니터링
- 네트워크 I/O 통계
- 연결 수 실시간 추적

## 문제 해결

### 연결 실패
1. 서버가 실행 중인지 확인
2. 포트 번호 확인 (기본값: 9200)
3. 방화벽 설정 확인

### 성능 이슈
1. 봇 수를 점진적으로 증가
2. 메시지 전송 간격 조정
3. 서버 리소스 모니터링

### 패킷 오류
1. 서버와 클라이언트 패킷 버전 일치 확인
2. 네트워크 연결 상태 확인
3. 로그 파일 확인 (load_test.log)

## 확장 가능성

- 다양한 테스트 시나리오 추가
- 웹 기반 모니터링 대시보드
- 분산 테스트 지원
- 더 정교한 통계 분석
- 자동화된 성능 리포트 생성
