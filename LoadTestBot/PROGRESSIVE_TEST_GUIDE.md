# 점진적 부하테스트 가이드

## 🎯 부하테스트 점진적 증가 전략

### **1. 기본 개념**

점진적 부하테스트는 서버의 **한계점을 안전하게 찾아내고**, **성능 병목을 식별**하는 핵심적인 방법입니다.

### **2. 부하 증가 패턴**

#### **🔄 선형 증가 (Linear)**
```
봇 수: 1 → 2 → 3 → 4 → 5 ...
특징: 안정적이고 예측 가능한 증가
용도: 기본 성능 파악, 웜업 테스트
```

#### **📈 지수적 증가 (Exponential)**  
```
봇 수: 1 → 2 → 4 → 8 → 16 → 32 → 64 ...
특징: 빠른 한계점 도달
용도: 최대 처리량 빠른 파악
```

#### **🪜 단계적 증가 (Step)**
```
봇 수: 5 → 10 → 15 → 20 → 25 ...
특징: 일정한 간격으로 증가
용도: 세밀한 성능 분석
```

#### **⚡ 스파이크 테스트 (Spike)**
```
봇 수: 10 → 100 (급증) → 10 (복구)
특징: 순간적인 부하 급증
용도: 갑작스런 트래픽 대응능력 검증
```

#### **🔼🔽 램프업/다운 (Ramp Up/Down)**
```
봇 수: 5 → 15 → 25 → 35 → 25 → 15 → 5
특징: 증가 후 감소하는 패턴
용도: 부하 변화에 따른 복구능력 검증
```

#### **🤖 적응형 자동 조절 (Adaptive)**
```
실시간 성능 모니터링으로 자동 조절
• CPU/메모리 사용률 기반
• 응답시간/오류율 기반  
• 자동 스케일업/다운
```

### **3. 실행 방법**

#### **A. 간단한 실행**
```bash
# 배치 스크립트 실행
run_progressive_test.bat

# 또는 직접 실행
python progressive_test.py --scenario 2
```

#### **B. 명령줄 실행**
```bash
# 기본 부하테스트 (5→50 봇, 5개씩 증가)
python progressive_test.py --scenario 2

# 사용자 정의 테스트
python progressive_test.py --start-bots 1 --max-bots 30 --step-size 3 --step-duration 45

# 적응형 자동 테스트
python adaptive_load_tester.py --initial-bots 5 --max-bots 100
```

#### **C. 대화형 모드**
```bash
python progressive_test.py --interactive

# 사용 가능한 명령어:
# list     - 시나리오 목록
# run 2    - 2번 시나리오 실행  
# custom   - 사용자 정의 시나리오
# status   - 현재 상태
# report   - 진행 상황 리포트
# export   - 결과 내보내기
# stop     - 테스트 중지
```

### **4. 사전 정의된 시나리오**

| 번호 | 시나리오명 | 패턴 | 봇 수 | 단계 | 용도 |
|------|------------|------|-------|------|------|
| 1 | 웜업 테스트 | 선형 | 1→10 | 1개씩/30초 | 기본 성능 파악 |
| 2 | 기본 부하테스트 | 단계 | 5→50 | 5개씩/60초 | 일반적인 부하테스트 |
| 3 | 지수적 증가 | 지수 | 1→64 | 2배씩/45초 | 빠른 한계점 탐지 |
| 4 | 스파이크 테스트 | 급증 | 10→100 | 급증/120초 | 순간 부하 대응능력 |
| 5 | 램프업/다운 | 증감 | 5→40→5 | 5개씩/30초 | 부하 변화 적응성 |
| 6 | 지속적 부하 | 지속 | 20개 | 고정/300초 | 안정성 테스트 |
| 7 | 스트레스 테스트 | 한계 | 10→200 | 실패까지 | 최대 처리량 탐지 |

### **5. 적응형 자동 테스트**

#### **성능 임계값 기반 자동 조절**
```python
# 기본 임계값
CPU 사용률: 80% 이하
메모리 사용률: 85% 이하  
응답시간: 1000ms 이하
성공률: 95% 이상
오류율: 5% 이하
```

#### **자동 스케일링 로직**
```
성능 양호 (30초 지속) → 봇 수 20% 증가
성능 악화 (즉시 감지) → 봇 수 20% 감소
```

#### **실시간 모니터링**
- 시스템 리소스 (CPU, 메모리)
- 서버 프로세스 상태
- 네트워크 연결 수
- 응답시간 및 처리량

### **6. 결과 분석**

#### **핵심 지표**
- **최대 안정 동접자 수**: 오류 없이 처리 가능한 최대 봇 수
- **응답시간 변화**: 부하 증가에 따른 지연시간 패턴
- **처리량 한계**: 초당 처리 가능한 최대 메시지 수
- **리소스 사용률**: CPU/메모리 사용 패턴
- **실패 임계점**: 서비스 장애가 시작되는 지점

#### **병목 구간 식별**
```
구간 1 (1-10 봇): 정상 - 선형 성능 증가
구간 2 (10-30 봇): 주의 - 응답시간 증가 시작
구간 3 (30-50 봇): 경고 - CPU 사용률 80% 도달
구간 4 (50+ 봇): 위험 - 연결 실패 발생
```

### **7. 실무 활용 팁**

#### **테스트 준비**
1. **서버 모니터링 활성화**
   ```bash
   python server_monitor.py &
   ```

2. **베이스라인 설정**
   ```bash
   # 먼저 웜업 테스트로 기본 성능 파악
   python progressive_test.py --scenario 1
   ```

#### **단계별 접근**
1. **1단계**: 웜업 테스트 (시나리오 1)
2. **2단계**: 기본 부하테스트 (시나리오 2)  
3. **3단계**: 스트레스 테스트 (시나리오 7)
4. **4단계**: 적응형 테스트로 최적점 탐색

#### **결과 해석**
```python
# 성능이 좋은 경우
성공률 > 99%, 응답시간 < 100ms, CPU < 50%
→ 더 많은 부하 적용 가능

# 성능 저하 시작
성공률 95-99%, 응답시간 100-500ms, CPU 50-80%  
→ 최적 운영점 근처

# 성능 한계 도달
성공률 < 95%, 응답시간 > 500ms, CPU > 80%
→ 스케일업 또는 최적화 필요
```

### **8. 고급 활용**

#### **다중 서버 테스트**
```bash
# 여러 서버 동시 테스트
python progressive_test.py --host server1 --port 9200 &
python progressive_test.py --host server2 --port 9200 &
```

#### **장기간 안정성 테스트**
```bash
# 24시간 지속 테스트
python adaptive_load_tester.py --duration 86400 --max-bots 30
```

#### **프로덕션 환경 시뮬레이션**
```bash
# 실제 사용자 패턴 모방 (램프업/다운)
python progressive_test.py --scenario 5
```

### **9. 문제 해결**

#### **연결 실패 시**
1. 서버 상태 확인
2. 포트 열림 상태 확인
3. 방화벽 설정 검토
4. 동시 연결 수 제한 확인

#### **성능 이상 시**
1. 시스템 리소스 모니터링
2. 네트워크 상태 점검  
3. 데이터베이스 성능 확인
4. 로그 파일 분석

#### **테스트 결과 활용**
1. **용량 계획**: 최대 처리량 기반 서버 규모 결정
2. **알람 설정**: 성능 임계값 기반 모니터링 구성
3. **오토스케일링**: 부하 패턴 기반 자동 확장 설정
4. **성능 최적화**: 병목 구간 개선 우선순위 결정

---

## 🚀 Quick Start

```bash
# 1. 기본 설정 확인
pip install psutil

# 2. 서버 시작 (ChattingServer.exe)

# 3. 간단한 테스트 실행
run_progressive_test.bat

# 4. 원하는 시나리오 선택 (1-9)

# 5. 결과 분석 및 활용
```

**이제 체계적인 점진적 부하테스트로 서버의 진짜 성능을 확인해보세요!** 🎯
